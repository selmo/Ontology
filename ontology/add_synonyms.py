#!/usr/bin/env python3
"""
Add comprehensive synonyms to ontology.json
Target: 87 → 250+ synonyms
"""

import json
import copy
from datetime import datetime

# Comprehensive synonym mappings by term ID
SYNONYM_ADDITIONS = {
    # 12. 재난안전 (21 terms, 0 synonyms → add ~40 synonyms)
    'T12010001': ['재해관리', '재난대응체계', '위기관리'],
    'T12010002': ['재해예방', '재난방지', '사전대비'],
    'T12010003': ['긴급대응', '재난대처', '재해대응', '비상대응'],
    'T12010004': ['재난복구', '재해복원', '피해복구'],
    'T12010005': ['재난통계', '재해통계', '피해통계'],
    'T12020001': ['안전관리체계', '안전확보', '위험관리'],
    'T12020002': ['시설안전', '건축물안전', '구조물안전'],
    'T12020003': ['생활안전관리', '일상안전', '시민안전'],
    'T12020004': ['교통안전관리', '도로안전', '차량안전'],
    'T12030001': ['비상대비체계', '긴급대비', '위기대비'],
    'T12030002': ['비상훈련', '재난훈련', '대피훈련'],
    'T12030003': ['구호활동', '구난구조', '인명구조'],
    'T12040001': ['자연재난', '자연재해', '천재지변'],
    'T12040002': ['태풍피해', '태풍재난'],
    'T12040003': ['호우피해', '폭우재난', '집중호우'],
    'T12040004': ['지진피해', '지진재난', '진동재해'],
    'T12050001': ['사회재난', '인적재난', '인위재난'],
    'T12050002': ['화재사고', '화재재난', '소방사고'],
    'T12050003': ['감염병재난', '전염병재해', '역병'],
    'T12050004': ['산업사고', '산업재해', '작업재해'],
    'T12050005': ['환경오염사고', '오염재난', '환경재해'],

    # 05. 법률 (19 terms, 7 synonyms → add ~30 synonyms)
    'T05010001': ['법령정보', '법규', '법제'],
    'T05010002': ['법', '법규범', '제정법'],
    'T05010003': ['대통령령', '시행규칙', '명령'],
    'T05010004': ['조례', '지방법규', '자치규칙'],
    'T05010005': ['행정명령', '고시', '훈령'],
    'T05020001': ['판결례', '재판례', '법원판례'],
    'T05020002': ['대법원판결', '상고심판례', '최고법원판례'],
    'T05020003': ['일반법원판례', '하급법원판례'],
    'T05020004': ['재판통계연보', '사법통계'],
    'T05030001': ['법률지원', '법률복지', '법무서비스'],
    'T05030002': ['법률자문', '법률컨설팅', '법무상담'],
    'T05030003': ['무료법률구조', '법률지원', '법률복지'],
    'T05040001': ['부동산등기', '소유권등기', '재산등기'],
    'T05040002': ['법인등기', '회사등기', '상업등기'],
    'T05050001': ['형사사법', '형법체계', '범죄처벌'],
    'T05050002': ['범죄통계', '범죄발생현황', '형사통계'],
    'T05060001': ['행정소송', '행정심판', '행정쟁송'],

    # 09. 문화관광 (20 terms, 12 synonyms → add ~25 synonyms)
    'T09010004': ['국가지정문화재', '국보급유물'],
    'T09010005': ['유네스코세계유산', '세계문화유산'],
    'T09020002': ['여행통계', '관광객통계', '방문객통계'],
    'T09020003': ['관광사업', '여행산업', '관광업'],
    'T09020004': ['여행사', '관광업체', '여행사업'],
    'T09030004': ['공연시설', '문화공간', '극장'],
    'T09030005': ['공공도서관', '도서관시설'],
    'T09040003': ['지역축제', '문화축제', '전통축제'],
    'T09040004': ['한국문화', 'K-Wave', '한국열풍'],
    'T09040005': ['한국문화콘텐츠', '케이팝', '한국대중문화'],

    # 02. 교육 (14 terms, 0 synonyms → add ~25 synonyms)
    'T02010001': ['교육통계', '학교통계연보'],
    'T02010002': ['학교현황', '학교통계', '교육기관현황'],
    'T02010003': ['교원현황', '교사통계', '교직원현황'],
    'T02010004': ['학생현황', '재적학생', '재학생통계'],
    'T02010005': ['교육예산', '학교재정', '교육비'],
    'T02020001': ['평생학습', '성인교육', '계속교육'],
    'T02020002': ['평생교육시설', '평생학습기관'],
    'T02020003': ['평생학습프로그램', '성인교육과정'],
    'T02020004': ['문해교육', '성인문해', '기초학습'],
    'T02020005': ['직업교육훈련', '직업능력개발훈련', '직무교육'],
    'T02030001': ['초중등교육', '공교육', '정규교육'],
    'T02030002': ['교육과정', '커리큘럼', '학습과정'],
    'T02030003': ['학업성취', '학력평가', '성적'],
    'T02030004': ['교육시설', '학교건물', '학습시설'],
    'T02030005': ['교육복지사업', '교육지원'],
    'T02040001': ['대학교육', '고등교육기관'],
    'T02040002': ['대학공시', '대학정보제공', '학교공시'],
    'T02040003': ['산학연협력', '대학-기업협력', '산학협동'],

    # 10. 환경기상 (17 terms, 10 synonyms → add ~20 synonyms)
    'T10010005': ['초미세먼지', '미세입자', '대기오염물질'],
    'T10010006': ['토양환경오염', '지하수오염'],
    'T10020004': ['온실가스감축목표', '국가감축목표', '배출감축목표'],
    'T10020005': ['기후변화적응', '기후대응', '기후탄력성'],
    'T10030004': ['기상주의보', '기상경보', '특보'],
    'T10030005': ['기후데이터', '기상정보', '날씨정보'],
    'T10040004': ['생태다양성', '생물종다양성'],
    'T10050001': ['재생에너지', '대체에너지', '청정에너지'],
    'T10050002': ['태양에너지', '태양광발전', '솔라'],
    'T10050003': ['풍력발전', '풍력에너지'],
    'T10050004': ['수소경제', '수소에너지'],
    'T10050005': ['에너지전환', '그린에너지', '탄소중립'],

    # 01. 공공행정 (12 terms, 0 synonyms → add ~20 synonyms)
    'T01010001': ['공기업', '공공단체', '공공조직'],
    'T01010002': ['정부조직', '행정조직', '부처조직도'],
    'T01010003': ['공공기관정보', '기관현황'],
    'T01020001': ['행정동', '법정동', '동리'],
    'T01020002': ['지자체', '광역자치단체', '기초자치단체'],
    'T01020003': ['읍사무소', '면사무소', '동주민센터'],
    'T01020004': ['주민센터', '동사무소', '행정센터'],
    'T01030001': ['전자정부', '디지털행정', '스마트행정'],
    'T01030002': ['정보자원관리', 'IT자산'],
    'T01030003': ['공공데이터포털', '공공정보개방', '오픈데이터'],
    'T01030004': ['정부혁신', '행정쇄신', '공공부문개혁'],
    'T01040001': ['국가정책', '정부사업', '국정과제'],

    # 07. 산업경제 (18 terms, 14 synonyms → add ~20 synonyms)
    'T07020002': ['자동차제조업', '차량산업'],
    'T07020003': ['생명공학산업', '바이오테크', 'BT산업'],
    'T07030001': ['3차산업', '서비스산업'],
    'T07040002': ['취업', '고용', '일자리창출'],
    'T07040003': ['실직률', '비취업률', '미취업률'],
    'T07040004': ['고용시장', '취업시장', '인력시장'],
    'T07040005': ['최저시급', '법정최저임금'],
    'T07050003': ['벤처기업', '스타트업회사', '신생기업'],
    'T07050004': ['창업지원기관', '인큐베이터'],
    'T07070001': ['무역', '대외무역', '수출입통계'],
    'T07070002': ['국제무역', '글로벌무역'],

    # 11. 과학기술 (12 terms, 0 synonyms → add ~20 synonyms)
    'T11010001': ['연구개발사업', 'R&D투자', '기술개발'],
    'T11010002': ['국가연구개발', '정부R&D', '국책연구'],
    'T11020001': ['자연과학분야', '기초과학'],
    'T11020002': ['물리과학', '물리학연구'],
    'T11030001': ['공학', '엔지니어링', '기술공학'],
    'T11030002': ['전자전기공학', '전기공학', '전자기술'],
    'T11040001': ['정보통신기술', 'ICT', '디지털기술'],
    'T11040002': ['머신러닝', '딥러닝', '지능형시스템'],
    'T11040003': ['대용량데이터', '데이터분석', '데이터과학'],
    'T11050001': ['특허권', '지식재산권', '발명특허'],
    'T11050002': ['기술이전', '기술사업화', '기술거래'],
    'T11050003': ['기술혁신', '신기술개발'],

    # 03. 보건의료 (16 terms, 13 synonyms → add ~10 synonyms)
    'T03010001': ['병원', '의료시설', '보건의료기관'],
    'T03010004': ['약국시설', '조제약국'],
    'T03010005': ['의료인프라', '병원시설'],
    'T03010006': ['의료기기', '진료장비', '의료설비'],
    'T03020002': ['외래진료통계', '입원통계'],
    'T03030002': ['의료인', '의료진', '임상의'],
    'T03030003': ['간호인력', '간호직'],
    'T03040001': ['국민건강보험', '의료보험'],
    'T03040002': ['의료보호', '의료지원'],
    'T03060002': ['의료영상', '진단영상', '의료이미지'],

    # 06. 재정금융 (16 terms, 16 synonyms → add ~10 synonyms)
    'T06010002': ['부문별예산', '사업별예산'],
    'T06010004': ['지출예산', '세출'],
    'T06010005': ['수입예산', '세입'],
    'T06020002': ['재정상태', '재무상태표', '재정현황'],
    'T06030001': ['지방정부재정', '지역재정'],
    'T06030002': ['지방교부금', '재정교부금'],
    'T06030003': ['재정자주도', '재정독립도'],
    'T06040002': ['지역세', '지방세금'],
    'T06050002': ['기금관리', '기금운영'],
    'T06060001': ['금융정책', '통화금융정책'],

    # 08. 디지털커머스 (8 terms, 5 synonyms → add ~5 synonyms)
    'T08030001': ['간편결제서비스', '모바일결제', '페이'],
    'T08030002': ['선구매후결제', '외상결제'],
    'T08040001': ['물류대행', '주문처리', '배송대행'],
    'T08040002': ['라스트마일배송', '최종배송', '막차배송'],
    'T08050001': ['실시간커머스', '라방'],
    'T08050002': ['구독서비스', '정기결제'],

    # 04. 사회복지 (9 terms, 10 synonyms → add ~5 synonyms)
    'T04010001': ['사회안전망', '사회복지제도'],
    'T04010002': ['사회보험제도', '4대보험'],
    'T04020002': ['노인시설', '양로시설', '요양시설'],
    'T04030001': ['사회적약자', '취약층', '소외계층'],
}


def add_synonyms_to_ontology(input_file='ontology.json', output_file='ontology.json'):
    """Add synonyms to ontology.json"""

    print(f"Loading {input_file}...")
    with open(input_file, 'r', encoding='utf-8') as f:
        data = json.load(f)

    # Statistics
    added_count = 0
    updated_terms = []

    # Process each domain
    for domain in data['domains']:
        for term in domain.get('terms', []):
            term_id = term['id']

            if term_id in SYNONYM_ADDITIONS:
                new_synonyms = SYNONYM_ADDITIONS[term_id]
                existing_synonyms = term.get('synonyms', [])

                # Add new synonyms (avoid duplicates)
                for syn in new_synonyms:
                    if syn not in existing_synonyms:
                        existing_synonyms.append(syn)
                        added_count += 1

                term['synonyms'] = existing_synonyms
                updated_terms.append({
                    'id': term_id,
                    'name': term['name_ko'],
                    'domain': domain['code'],
                    'new_count': len(new_synonyms),
                    'total': len(existing_synonyms)
                })

    # Update metadata
    data['metadata']['version'] = '3.8.0'
    data['metadata']['last_updated'] = datetime.now().strftime('%Y-%m-%d')
    data['metadata']['description'] = 'MC 분류·용어 통합 체계 (동의어 대폭 확장: 87 → 250+)'

    # Save
    print(f"Saving to {output_file}...")
    with open(output_file, 'w', encoding='utf-8') as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

    # Print report
    print("\n" + "=" * 80)
    print("동의어 추가 완료")
    print("=" * 80)
    print(f"총 추가된 동의어 수: {added_count}")
    print(f"업데이트된 용어 수: {len(updated_terms)}")
    print(f"\n도메인별 추가 내역:")
    print("-" * 80)

    # Group by domain
    from collections import defaultdict
    domain_stats = defaultdict(lambda: {'count': 0, 'terms': 0})

    for term_info in updated_terms:
        domain_code = term_info['domain']
        domain_stats[domain_code]['count'] += term_info['new_count']
        domain_stats[domain_code]['terms'] += 1

    # Find domain names
    domain_names = {d['code']: d['name_ko'] for d in data['domains']}

    for domain_code in sorted(domain_stats.keys()):
        stats = domain_stats[domain_code]
        domain_name = domain_names.get(domain_code, domain_code)
        print(f"{domain_code}. {domain_name}: {stats['count']}개 동의어 ({stats['terms']}개 용어)")

    print("\n" + "=" * 80)
    print("업데이트된 용어 상세 (처음 20개):")
    print("-" * 80)

    for i, term_info in enumerate(updated_terms[:20]):
        print(f"{term_info['id']}: {term_info['name']} → {term_info['total']}개 동의어")

    if len(updated_terms) > 20:
        print(f"... 외 {len(updated_terms) - 20}개")

    return added_count, len(updated_terms)


if __name__ == '__main__':
    added, updated = add_synonyms_to_ontology()
    print(f"\n✅ 완료: {added}개 동의어가 {updated}개 용어에 추가됨")
